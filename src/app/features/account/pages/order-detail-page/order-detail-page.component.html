<div class="content-panel active">
  @if (order(); as currentOrder) {
    <header class="mb-8 grid grid-cols-1 items-center gap-6 rounded-2xl border border-border-color bg-gradient-to-br from-dark-bg-secondary to-[#171d33] p-6 shadow-2xl shadow-black/30 md:grid-cols-[1fr_auto_auto]">
        <div>
            <a routerLink="/account/orders" class="text-sm text-primary-accent hover:underline flex items-center gap-2 mb-2">
                <i class="fas fa-arrow-left"></i> Volver a Mis Pedidos
            </a>
            <h1 class="m-0 text-3xl font-bold font-headings">Pedido <span class="text-primary-accent">#{{ currentOrder.id }}</span></h1>
            <div class="text-sm text-text-secondary">Realizado el {{ currentOrder.date | date:'dd MMM, yyyy, h:mm a' }}</div>
        </div>
        <div class="text-center">
            <div class="mb-2 text-xs font-semibold uppercase text-text-secondary">Estado Actual</div>
            <span class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-bold" [ngClass]="{
                'bg-text-secondary/20 text-text-secondary': currentOrder.status === 'Pedido Realizado' || currentOrder.status === 'Pago Confirmado',
                'bg-warning/20 text-warning': currentOrder.status === 'Procesando',
                'bg-primary-accent/20 text-primary-accent': currentOrder.status === 'Enviado',
                'bg-success/20 text-success': currentOrder.status === 'Entregado',
                'bg-danger/20 text-danger': currentOrder.status === 'Cancelado'
              }">
              <span class="h-2 w-2 rounded-full" [ngClass]="{
                'bg-text-secondary': currentOrder.status === 'Pedido Realizado' || currentOrder.status === 'Pago Confirmado',
                'bg-warning animate-pulse': currentOrder.status === 'Procesando',
                'bg-primary-accent animate-pulse': currentOrder.status === 'Enviado',
                'bg-success': currentOrder.status === 'Entregado',
                'bg-danger': currentOrder.status === 'Cancelado'
              }"></span>
              {{ currentOrder.status }}
            </span>
        </div>
        <div class="text-center">
            <div class="mb-2 text-xs font-semibold uppercase text-text-secondary">Grand Total</div>
            <div class="text-3xl font-bold text-success">{{ currentOrder.total | currency:'USD' }}</div>
        </div>
    </header>

    <section class="data-card mb-8">
      <div class="card-header"><i class="fas fa-stream"></i><h3>Línea de Tiempo del Pedido</h3></div>
      <div class="card-body">
          <ul class="relative flex justify-between">
              <div class="absolute left-0 top-4 h-0.5 w-full bg-border-color"></div>
              @for(step of timelineSteps(); track step.name) {
              <li class="relative flex-1 text-center">
                  <div class="step-icon" [ngClass]="step.status"><i [class]="step.icon"></i></div>
                  <div class="step-label mt-3 text-xs text-text-secondary">{{ step.name }}</div>
              </li>
              }
          </ul>
      </div>
    </section>

    <div class="order-detail-grid">
        <div class="data-card">
            <div class="card-header"><i class="fas fa-box-open"></i><h3>Artículos del Pedido</h3></div>
            <div class="card-body !p-0">
                @for(item of currentOrder.items; track item.product.id) {
                    <div class="item-card">
                        <img [src]="item.product.imageUrl" [alt]="item.product.name" class="item-card-img">
                        <div class="item-info">
                            <h4 class="font-semibold">{{ item.product.name }}</h4>
                            <p class="text-text-secondary">Cantidad: {{ item.quantity }}</p>
                        </div>
                        <p class="item-price">{{ (item.product.price * item.quantity) | currency }}</p>
                    </div>
                }
            </div>
        </div>
        <div class="data-card h-fit">
             <div class="card-header"><i class="fas fa-file-invoice-dollar"></i><h3>Resumen</h3></div>
             <div class="card-body space-y-3">
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span>{{ subtotal() | currency:'USD' }}</span>
                </div>
                <div class="summary-row">
                    <span>Envío:</span>
                    <span>$0.00</span>
                </div>
                <div class="summary-row total">
                    <span>Total:</span>
                    <span>{{ currentOrder.total | currency:'USD' }}</span>
                </div>
            </div>
        </div>
    </div>
  } @else {
    <p class="text-text-secondary">No se pudo cargar la información del pedido.</p>
  }
</div>

<style>
  .data-card {
    @apply rounded-2xl border border-border-color bg-dark-bg-secondary shadow-lg;
  }
  .card-header {
    @apply flex items-center gap-3 border-b border-border-color p-5;
  }
  .card-header h3 {
    @apply m-0 text-base font-bold text-text-primary;
  }
  .card-header i {
    @apply text-primary-accent;
  }
  .card-body {
    @apply p-6;
  }
  .step-icon {
    @apply relative z-10 mx-auto flex h-8 w-8 items-center justify-center rounded-full border-2 bg-dark-bg transition-all;
  }
  .step-icon.pending { @apply border-border-color text-text-secondary; }
  .step-icon.active { @apply scale-110 border-primary-accent text-primary-accent shadow-[0_0_15px_theme(colors.primary-accent/50)]; }
  .step-icon.completed { @apply border-success bg-success text-white; }

  .order-detail-grid { @apply grid grid-cols-1 lg:grid-cols-[2fr_1fr] gap-8; }
  .item-card { @apply flex flex-col sm:flex-row items-center gap-4 p-4 border-b border-border-color; }
  .item-card:last-child { @apply border-none; }
  .item-card-img { @apply w-20 h-20 object-contain bg-dark-bg rounded-lg; }
  .item-info { @apply flex-grow text-center sm:text-left; }
  .item-price { @apply font-semibold text-lg; }
  .summary-row { @apply flex justify-between; }
  .total { @apply text-xl font-bold border-t border-border-color pt-4 mt-4; }
</style>
