@if (order(); as data) {
<div #mainContainer class="min-h-screen flex flex-col items-center justify-center pt-32 pb-16 px-4 bg-dark-bg bg-[radial-gradient(circle_at_20%_20%,rgba(0,169,255,0.1)_0%,transparent_30%),radial-gradient(circle_at_80%_70%,rgba(128,0,255,0.1)_0%,transparent_30%)]">
  <div class="animate-fade-in-up" style="animation-delay: 0.2s;">
    <div class="bg-gradient-to-r from-primary-accent to-purple-500 text-white font-bold py-2 px-6 rounded-full inline-flex items-center gap-2 mb-6">
      <i class="fas fa-trophy"></i><span>¡Logro Desbloqueado!</span>
    </div>
  </div>

  <h1 class="font-sora text-4xl md:text-5xl font-extrabold text-white text-center mb-8 animate-fade-in-up" style="animation-delay: 0.4s;">
    Cargamento Registrado en tu Arsenal
  </h1>

  <div class="w-full max-w-5xl grid grid-cols-1 lg:grid-cols-2 gap-8 items-start animate-fade-in-up" style="animation-delay: 0.6s;">
    <div #cargoBay id="cargo-bay" class="relative group h-[450px] flex items-center justify-center p-4 [perspective:1000px]">
      <div class="w-full h-full transition-transform duration-500 ease-out opacity-0 [transform:scale(0.95)_translateZ(-50px)] data-[is-open=true]:opacity-100 data-[is-open=true]:[transform:scale(1)_translateZ(0)]" [attr.data-is-open]="isCargoBayOpen()">
        <div class="swiper h-full">
          <div class="swiper-wrapper">
            @for (item of data.items; track item.product.id) {
              <div class="swiper-slide !flex !items-center !justify-center">
                <div class="relative w-full h-[90%] bg-dark-surface rounded-2xl border border-white/10 overflow-hidden">
                  <img [src]="item.product.imageUrl" [alt]="item.product.name" class="absolute inset-0 w-full h-full object-contain p-8 drop-shadow-2xl">
                  <div class="relative w-full h-full flex flex-col justify-end p-6 bg-gradient-to-t from-dark-surface via-dark-surface/80 to-transparent">
                    <h2 class="font-sora text-2xl font-bold text-white text-center">{{ item.product.name }}</h2>
                    <p class="text-primary-accent font-semibold mt-2 text-center">{{ item.quantity }} Unidad(es)</p>
                  </div>
                </div>
              </div>
            }
          </div>
          <div class="swiper-pagination"></div>
          <div class="swiper-button-prev !text-primary-accent"></div>
          <div class="swiper-button-next !text-primary-accent"></div>
        </div>
      </div>
      <div class="absolute top-0 left-0 w-1/2 h-full bg-[#0d121c] border-r-2 border-gray-700 rounded-l-2xl z-20 transition-transform duration-1000 [transform-style:preserve-3d] ease-[cubic-bezier(0.86,0,0.07,1)] data-[is-open=true]:[-webkit-transform:translateX(-105%)_rotateY(45deg)] data-[is-open=true]:[transform:translateX(-105%)_rotateY(45deg)]" [attr.data-is-open]="isCargoBayOpen()"></div>
      <div class="absolute top-0 right-0 w-1/2 h-full bg-[#0d121c] border-l-2 border-gray-700 rounded-r-2xl z-20 transition-transform duration-1000 [transform-style:preserve-3d] ease-[cubic-bezier(0.86,0,0.07,1)] data-[is-open=true]:[-webkit-transform:translateX(105%)_rotateY(-45deg)] data-[is-open=true]:[transform:translateX(105%)_rotateY(-45deg)]" [attr.data-is-open]="isCargoBayOpen()"></div>
      @if (!isCargoBayOpen()) {
        <button #revealButton (click)="revealCargo(revealButton)" class="animate-pulse-button absolute inset-0 m-auto w-60 h-16 bg-primary-accent/80 text-white font-bold rounded-lg flex items-center justify-center gap-3 backdrop-blur-sm border border-white/20 hover:bg-primary-accent transition-all duration-300 text-lg z-30">
          <i class="fas fa-lock-open"></i> Despresurizar
        </button>
      }
    </div>
    <div class="bg-dark-surface/50 border border-white/10 rounded-2xl p-8 backdrop-blur-md">
        <h3 class="font-sora text-xl font-bold text-white mb-4">Manifiesto del Cargamento</h3>
        <ul class="space-y-3 text-sm mb-6 border-b border-white/10 pb-6">
            @for (item of data.items; track item.product.id) {
              <li class="flex justify-between items-center">
                  <span class="text-gray-300">{{ item.product.name }}</span>
                  <span class="font-semibold text-gray-300">x{{ item.quantity }}</span>
              </li>
            }
        </ul>
        <div class="space-y-3 text-sm mb-6">
            <div class="flex justify-between items-center"><span class="text-gray-400">ID de Misión:</span><span class="font-semibold text-primary-accent font-mono">{{ data.id }}</span></div>
            <div class="flex justify-between items-center"><span class="text-gray-400">Inversión Total:</span><span class="font-semibold text-brand-yellow">{{ data.total | currency:'USD' }}</span></div>
        </div>

        <div id="logistics-panel" class="mt-6">
            <div id="logistics-delivery" class="logistics-card" [class.hidden]="activeLogisticsPanel() !== 'delivery'">
                <div class="flex items-center gap-4 mb-3"><i class="fas fa-motorcycle text-primary-accent text-xl"></i><h3 class="font-sora text-xl font-bold text-white">Logística de la Misión</h3></div>
                <div class="bg-dark-surface p-4 rounded-lg space-y-2 text-sm">
                    <div class="flex justify-between"><span class="text-gray-400">Método:</span> <strong class="font-mono">Delivery Local</strong></div>
                    <div class="flex justify-between"><span class="text-gray-400">Servicio:</span> <strong>{{ data.deliveryDetails?.service }}</strong></div>
                    <div class="flex justify-between"><span class="text-gray-400">Agente:</span> <strong>{{ data.deliveryDetails?.agent }}</strong></div>
                    <div class="flex justify-between"><span class="text-gray-400">Estado:</span> <strong class="text-green-400">{{ data.deliveryDetails?.tracking }}</strong></div>
                </div>
            </div>
            <div id="logistics-envio" class="logistics-card" [class.hidden]="activeLogisticsPanel() !== 'envio'">
                <div class="flex items-center gap-4 mb-3"><i class="fas fa-truck-fast text-primary-accent text-xl"></i><h3 class="font-sora text-xl font-bold text-white">Logística de la Misión</h3></div>
                <div class="bg-dark-surface p-4 rounded-lg space-y-2 text-sm">
                    <div class="flex justify-between"><span class="text-gray-400">Método:</span> <strong class="font-mono">Envío Nacional</strong></div>
                    <div class="flex justify-between"><span class="text-gray-400">Operador:</span> <strong>{{ data.deliveryDetails?.service }}</strong></div>
                    <div class="flex justify-between items-center"><span class="text-gray-400">N° Guía:</span> <a href="#" class="font-mono text-primary-accent hover:underline">{{ data.deliveryDetails?.tracking }}</a></div>
                    <div class="flex justify-between"><span class="text-gray-400">Estado:</span> <strong class="text-yellow-400">En Tránsito</strong></div>
                </div>
            </div>
            <div id="logistics-retiro" class="logistics-card" [class.hidden]="activeLogisticsPanel() !== 'retiro'">
                <div class="flex items-center gap-4 mb-3"><i class="fas fa-store text-primary-accent text-xl"></i><h3 class="font-sora text-xl font-bold text-white">Logística de la Misión</h3></div>
                <div class="bg-dark-surface p-4 rounded-lg space-y-2 text-sm">
                    <div class="flex justify-between"><span class="text-gray-400">Método:</span> <strong class="font-mono">Retiro Personal</strong></div>
                    <div class="flex justify-between"><span class="text-gray-400">Punto:</span> <strong>{{ data.deliveryDetails?.point }}</strong></div>
                    <div class="flex justify-between"><span class="text-gray-400">Procesado por:</span> <strong>{{ data.deliveryDetails?.agent }}</strong></div>
                    <div class="flex justify-between"><span class="text-gray-400">Estado:</span> <strong class="text-green-400">{{ data.deliveryDetails?.tracking }}</strong></div>
                </div>
            </div>
        </div>
    </div>
  </div>

  <div class="w-full max-w-5xl mt-12 animate-fade-in-up" style="animation-delay: 0.8s;">
    <div class="bg-dark-surface/50 border border-white/10 rounded-2xl p-6 backdrop-blur-md flex flex-col sm:flex-row items-center gap-6">
      <div class="flex-shrink-0"><div class="w-24 h-24 rounded-full bg-dark-surface border-2 border-primary-accent flex items-center justify-center"><i class="fas fa-clone text-5xl text-primary-accent"></i></div></div>
      <div class="flex-grow text-center sm:text-left">
        <h3 class="font-sora text-xl font-bold text-white">Dossiers de Adquisición</h3>
        <p class="text-gray-400">{{ data.items.length }} nuevos equipos han sido añadidos a tu Arsenal.</p>
        <p class="text-sm text-gray-500 mt-1">Adquiridos el: <span>{{ data.date | date:'longDate' }}</span></p>
      </div>
      <div class="flex-shrink-0">
        <a routerLink="/account/arsenal" class="bg-gray-700 text-gray-200 font-bold py-3 px-6 rounded-lg transition-all duration-300 hover:bg-gray-600 hover:text-white flex items-center gap-2">
          <i class="fas fa-download"></i> Inspeccionar Arsenal
        </a>
      </div>
    </div>
  </div>

  <div class="w-full max-w-5xl mt-12 animate-fade-in-up" style="animation-delay: 1s;">
    <h2 class="font-sora text-2xl font-bold text-center text-white mb-6">Tracking de la Misión</h2>
    <div class="bg-dark-surface/50 border border-white/10 rounded-2xl p-6 backdrop-blur-md">
      <div class="flex items-center justify-between w-full">
        @for (step of statusSteps; track step; let i = $index) {
          <div class="text-center w-1/5">
            <div class="relative mx-auto w-10 h-10 flex items-center justify-center rounded-full" [ngClass]="getStatusStepClass(step, i)">
              @switch (step) {
                @case('Pedido Realizado') { <i class="fas fa-receipt text-dark-bg font-bold"></i> }
                @case('Pago Confirmado') { <i class="fas fa-credit-card text-dark-bg font-bold"></i> }
                @case('Procesando') { <i class="fas fa-cogs text-white"></i> }
                @case('Enviado') { <i class="fas fa-truck text-gray-500"></i> }
                @case('Entregado') { <i class="far fa-check-circle text-gray-500"></i> }
              }
            </div>
            <p class="mt-2 text-xs font-semibold" [class.text-white]="i < statusSteps.indexOf(currentStatus)" [class.text-primary-accent]="step === currentStatus" [class.text-gray-500]="i > statusSteps.indexOf(currentStatus)">{{ step }}</p>
          </div>
          @if (!$last) {
            <div class="flex-1 h-0.5 mx-2" [ngClass]="getProgressBarClass(i)"></div>
          }
        }
      </div>
    </div>
  </div>
</div>
} @else {
  <div class="h-screen flex flex-col items-center justify-center text-center px-4">
    <i class="fas fa-satellite-dish text-6xl text-primary-accent mb-4"></i>
    <h1 class="text-4xl font-headings font-bold">Señal Perdida</h1>
    <p class="text-lg text-text-secondary mt-2">No pudimos encontrar los datos de tu pedido.</p>
    <a routerLink="/" class="mt-8 bg-primary-accent text-dark-bg font-bold py-3 px-6 rounded-lg transition-transform hover:-translate-y-1">Volver al Inicio</a>
  </div>
}
