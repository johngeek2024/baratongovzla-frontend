<div class="products-theme text-text-primary">
  @if (missionData(); as data) {
    <div class="max-w-4xl mx-auto px-4 md:px-8 pt-28 pb-16 text-center">
      <header>
        <div class="text-6xl text-green-500 mb-6 animate-pulse">
          <i class="fas fa-check-circle"></i>
        </div>
        <h1 class="text-5xl font-headings font-bold">Misión Aceptada</h1>
        <p class="text-lg text-text-secondary mt-2 max-w-xl mx-auto">
          Hemos recibido tu pedido en <strong>BaratongoVzla</strong> y nuestro equipo ya está preparando tu paquete para el despliegue.
        </p>
        <div class="inline-block bg-dark-bg-secondary border border-border-color px-4 py-2 rounded-lg font-semibold mt-4">
          Número de Pedido: <strong class="text-primary-accent">{{ data.orderNumber }}</strong>
        </div>
      </header>

      <div class="my-20 relative h-20">
        <div class="absolute top-1/2 left-0 w-full h-1 -translate-y-1/2">
          <div class="progress-bar absolute top-0 left-0 h-full rounded-full" [style.width]="progressWidth()"></div>
        </div>
        <div class="relative flex justify-between items-center w-full">
          @for(step of statusSteps; track step) {
            <div class="flex flex-col items-center">
              <div class="w-10 h-10 rounded-full bg-dark-bg border-2 flex items-center justify-center transition-all duration-500"
                   [ngClass]="{ 'active-step': isStepActive(step), 'border-border-color': !isStepActive(step), 'delivered-animation': isStepActive(step) && step === 'Entregado' }">
                @switch (step) {
                  @case ('Confirmado') { <i class="fas fa-check" [ngClass]="isStepActive(step) ? 'text-dark-bg' : 'text-text-secondary'"></i> }
                  @case ('Procesando') { <i class="fas fa-cogs" [ngClass]="isStepActive(step) ? 'text-dark-bg' : 'text-text-secondary'"></i> }
                  @case ('En Ruta') { <i class="fas fa-shipping-fast" [ngClass]="isStepActive(step) ? 'text-dark-bg' : 'text-text-secondary'"></i> }
                  @case ('Entregado') { <i class="fas fa-gift" [ngClass]="isStepActive(step) ? 'text-dark-bg' : 'text-text-secondary'"></i> }
                }
              </div>
              <span class="mt-4 font-semibold transition-colors duration-300 w-24 absolute top-full" [ngClass]="isStepActive(step) ? 'text-text-primary' : 'text-text-secondary'">
                {{ step }}
              </span>
            </div>
          }
        </div>
      </div>

      <div class="text-left bg-dark-bg-secondary border border-border-color rounded-2xl p-6 md:p-8 grid grid-cols-1 md:grid-cols-[1.5fr_1fr] gap-8">
        <div class="bg-dark-bg rounded-lg p-4 h-full min-h-[300px] flex items-center justify-center">
          <svg viewBox="0 0 300 200" xmlns="http://www.w3.org/2000/svg" class="w-full h-full" overflow="visible">
            <path d="M10 180 L40 160 L80 190 L150 140 L220 170 L260 130 L290 150 V 195 H 10 Z" fill="#111827" />
            <path id="route-path" d="M50 150 C 100 50, 200 50, 250 150" stroke="#374151" stroke-width="2" fill="none" class="route-line"/>
            <circle cx="50" cy="150" r="6" fill="#00A9FF" class="pulse-point-origin" />
            <circle cx="250" cy="150" r="6" fill="#22c55e" class="pulse-point-destination" />
            <circle id="package-dot" r="5" fill="#ffd724" class="travel-dot-glow"/>
          </svg>
        </div>

        <div class="flex flex-col">
          <h3 class="text-xl font-headings font-bold mb-4">Manifiesto de Misión</h3>
          <div class="space-y-2">
            <div class="flex justify-between"><span>Subtotal:</span><span class="font-semibold">{{ data.subtotal | currency:'USD' }}</span></div>
            <div class="flex justify-between"><span>Envío:</span><span class="font-semibold">{{ data.shippingCost | currency:'USD' }}</span></div>
          </div>
          <div class="flex justify-between text-xl font-bold mt-4 pt-4 border-t border-border-color">
            <span>Total:</span><span>{{ data.total | currency:'USD' }}</span>
          </div>

          <hr class="border-border-color my-6">

          <div class="space-y-4 text-sm">
            <h4 class="text-base font-headings font-bold">Resumen Logístico</h4>
            <div class="flex items-start gap-3">
              <i class="fab fa-whatsapp w-5 text-center text-green-400 mt-1"></i>
              <div class="flex-grow">
                <span class="text-text-secondary">Contacto (WhatsApp):</span>
                <strong class="block text-text-primary">{{ data.customerPhone }}</strong>
              </div>
            </div>
            <div class="flex items-start gap-3">
              <i class="fas fa-wallet w-5 text-center text-primary-accent mt-1"></i>
              <div class="flex-grow">
                <span class="text-text-secondary">Método de Pago:</span>
                @switch (data.paymentMethod) {
                  @case('pago_movil') { <strong class="block">Pago Móvil</strong> }
                  @case('binance') { <strong class="block">Binance Pay</strong> }
                  @case('cash') { <strong class="block">Efectivo</strong> }
                  @default { <strong class="block">No especificado</strong> }
                }
              </div>
            </div>
             @if(data.paymentReference) {
              <div class="flex items-start gap-3">
                @if(data.paymentMethod === 'binance') {
                  <i class="fas fa-receipt w-5 text-center text-primary-accent mt-1"></i>
                } @else {
                  <i class="fas fa-hashtag w-5 text-center text-primary-accent mt-1"></i>
                }
                <div class="flex-grow">
                  <span class="text-text-secondary">
                    {{ data.paymentMethod === 'binance' ? 'ID de Transacción:' : 'Referencia:' }}
                  </span>
                  <strong class="block break-all">{{ data.paymentReference }}</strong>
                </div>
              </div>
            }
            <div class="flex items-start gap-3">
              <i class="fas fa-dolly-flatbed w-5 text-center text-primary-accent mt-1"></i>
              <div class="flex-grow">
                <span class="text-text-secondary">Método de Entrega:</span>
                @switch (data.deliveryMethod) {
                  @case ('pickup') { <strong class="block">Retiro en Punto Gratuito</strong> <span class="text-xs text-text-secondary">Punto: {{ data.pickupPoint }}</span> }
                  @case ('delivery') { <strong class="block">Delivery Local ({{ data.deliveryVehicle }})</strong> <span class="text-xs text-text-secondary">Zona: {{ data.deliveryZone }}</span> }
                  @case ('shipping') { <strong class="block">Envío Nacional</strong> <span class="text-xs text-text-secondary">Agencia especificada.</span> }
                }
              </div>
            </div>
            @if (data.deliveryMethod === 'delivery' || data.deliveryMethod === 'shipping') {
              <div class="flex items-start gap-3">
                <i class="fas fa-map-marker-alt w-5 text-center text-primary-accent mt-1"></i>
                <div class="flex-grow">
                  <span class="text-text-secondary">Destino del Paquete:</span>
                  <strong class="block text-text-primary">{{ data.customerName }}</strong>
                  <p class="font-normal text-text-primary leading-tight m-0">{{ data.shippingAddress }}</p>
                </div>
              </div>
            }
          </div>
        </div>
      </div>

      <div class="mt-12 flex justify-center gap-4">
        <a routerLink="/account" class="bg-primary-accent text-dark-bg font-bold py-3 px-6 rounded-lg transition-transform hover:-translate-y-1">Ir a Mi Cuenta</a>
        <a routerLink="/" class="bg-border-color text-text-primary font-bold py-3 px-6 rounded-lg transition-transform hover:-translate-y-1">Seguir Explorando</a>
      </div>
    </div>
  } @else {
    <div class="h-screen flex flex-col items-center justify-center text-center px-4">
        <i class="fas fa-satellite-dish text-6xl text-primary-accent mb-4"></i>
        <h1 class="text-4xl font-headings font-bold">Señal Perdida</h1>
        <p class="text-lg text-text-secondary mt-2">No pudimos encontrar los datos de tu pedido.</p>
        <a routerLink="/" class="mt-8 bg-primary-accent text-dark-bg font-bold py-3 px-6 rounded-lg transition-transform hover:-translate-y-1">Volver al Inicio</a>
    </div>
  }
</div>

<style>
  .progress-bar {
    background: linear-gradient(90deg, #16a34a, #22c55e);
    transition: width 1.2s cubic-bezier(0.65, 0, 0.35, 1);
    position: relative;
    overflow: hidden;
  }
  .progress-bar::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 50%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    animation: shine 2.5s infinite linear;
  }
  .active-step {
    background-color: #22c55e;
    border-color: #22c55e;
    transform: scale(1.1);
    box-shadow: 0 0 15px rgba(34, 197, 94, 0.7);
  }
  .delivered-animation {
    animation: delivered-pulse 1.5s infinite;
  }
  @keyframes shine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(200%); }
  }
  @keyframes delivered-pulse {
    0% { transform: scale(1.1); box-shadow: 0 0 15px rgba(34, 197, 94, 0.7); }
    50% { transform: scale(1.2); box-shadow: 0 0 25px rgba(34, 197, 94, 1); }
    100% { transform: scale(1.1); box-shadow: 0 0 15px rgba(34, 197, 94, 0.7); }
  }
  .route-line {
    stroke-dasharray: 1000;
    stroke-dashoffset: 1000;
    animation: draw-line 2s 0.5s ease-out forwards;
  }
  .travel-dot-glow {
    offset-path: path("M50 150 C 100 50, 200 50, 250 150");
    animation: move-along-path 4s 1.5s ease-in-out infinite;
    filter: drop-shadow(0 0 4px #ffd724);
  }
  .pulse-point-origin, .pulse-point-destination {
    animation: pulse-point 2.5s infinite ease-in-out;
  }
  .pulse-point-destination {
    animation-delay: 0.5s;
  }
  @keyframes draw-line { to { stroke-dashoffset: 0; } }
  @keyframes move-along-path {
    0% { offset-distance: 0%; opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { offset-distance: 100%; opacity: 0; }
  }
  @keyframes pulse-point {
    0% { r: 6; }
    50% { r: 9; }
    100% { r: 6; }
  }
</style>
