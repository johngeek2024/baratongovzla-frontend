<header class="content-header">
  <h1 class="text-2xl sm:text-3xl font-bold">Gestión de Marketing y Contenido</h1>
</header>

<nav class="flex items-center gap-2 border-b border-border-color mb-8">
  <button (click)="selectTab('banners')" [class.active]="activeTab() === 'banners'" class="bg-transparent border-0 px-5 py-3 font-semibold text-text-secondary cursor-pointer transition-all duration-200 border-b-2 border-transparent -mb-px flex items-center gap-2 hover:text-white active:text-primary-accent active:border-primary-accent">
    <i class="fas fa-images"></i> Banners del Carrusel
  </button>
  <button (click)="selectTab('stage')" [class.active]="activeTab() === 'stage'" class="bg-transparent border-0 px-5 py-3 font-semibold text-text-secondary cursor-pointer transition-all duration-200 border-b-2 border-transparent -mb-px flex items-center gap-2 hover:text-white active:text-primary-accent active:border-primary-accent">
    <i class="fas fa-desktop"></i> Bundle "Product Stage"
  </button>
  <button (click)="selectTab('bundle')" [class.active]="activeTab() === 'bundle'" class="bg-transparent border-0 px-5 py-3 font-semibold text-text-secondary cursor-pointer transition-all duration-200 border-b-2 border-transparent -mb-px flex items-center gap-2 hover:text-white active:text-primary-accent active:border-primary-accent">
    <i class="fas fa-cubes"></i> Bundle "Destacados"
  </button>
  <button (click)="selectTab('quick-cat')" [class.active]="activeTab() === 'quick-cat'" class="bg-transparent border-0 px-5 py-3 font-semibold text-text-secondary cursor-pointer transition-all duration-200 border-b-2 border-transparent -mb-px flex items-center gap-2 hover:text-white active:text-primary-accent active:border-primary-accent">
    <i class="fas fa-star"></i> Categorías Rápidas
  </button>
</nav>

<div class="animate-[fadeIn_0.5s_ease]">
  @switch (activeTab()) {
    @case ('banners') {
      <div class="bg-dark-bg-secondary border border-border-color rounded-xl p-6">
        <div class="flex justify-between items-center mb-4">
          <h3 class="!m-0">Banners del Carrusel Principal</h3>
          <a routerLink="/admin/marketing/new" class="bg-primary-accent text-dark-bg border-none px-6 py-2.5 rounded-lg font-bold cursor-pointer inline-flex items-center justify-center disabled:opacity-60 disabled:bg-border-color disabled:cursor-not-allowed"><i class="fas fa-plus"></i> Añadir Banner</a>
        </div>
        <div class="bg-transparent border-none !p-0">
          <table class="w-full border-collapse">
            <tbody>
              @for (banner of banners(); track banner.id) {
                <tr>
                  <td class="p-4 text-left border-b border-border-color font-semibold text-white">{{ banner.internalName }}</td>
                  <td class="p-4 text-left border-b border-border-color">
                    @if (banner.isActive) { <span class="py-1 px-3 rounded-full text-xs font-bold bg-success/20 text-success">Activo</span> }
                    @else { <span class="py-1 px-3 rounded-full text-xs font-bold bg-danger/20 text-danger">Inactivo</span> }
                  </td>
                  <td class="p-4 text-left border-b border-border-color">
                    <a [routerLink]="['/admin/marketing/edit', banner.id]" class="bg-transparent border-none text-text-secondary cursor-pointer text-lg p-2 transition-colors duration-200 inline-block hover:text-primary-accent"><i class="fas fa-edit"></i></a>
                    <button class="bg-transparent border-none text-text-secondary cursor-pointer text-lg p-2 transition-colors duration-200 inline-block hover:text-danger" (click)="openDeleteConfirmation(banner)"><i class="fas fa-trash"></i></button>
                  </td>
                </tr>
              } @empty {
                <tr><td colspan="3" class="text-center text-text-secondary py-4 p-4 border-b border-border-color last:border-none">No hay banners creados.</td></tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }
    @case ('stage') {
      <form [formGroup]="productStageForm" (ngSubmit)="saveProductStage()" class="bg-dark-bg-secondary border border-border-color rounded-xl p-6">
        <h3 class="mb-6">Editar Bundle "Product Stage"</h3>
        <div class="space-y-4">
          <div><label class="block text-sm font-medium text-text-primary mb-1">URL Imagen de Fondo</label><input formControlName="backgroundUrl" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white"></div>
          <div><label class="block text-sm font-medium text-text-primary mb-1">Título</label><input formControlName="title" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white"></div>
          <div><label class="block text-sm font-medium text-text-primary mb-1">Párrafo</label><textarea formControlName="paragraph" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white" rows="3"></textarea></div>
          <div class="grid grid-cols-2 gap-4">
            <div><label class="block text-sm font-medium text-text-primary mb-1">Texto del Botón</label><input formControlName="buttonText" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white"></div>
            <div><label class="block text-sm font-medium text-text-primary mb-1">Enlace del Botón</label><input formControlName="buttonLink" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white"></div>
          </div>
          <div class="flex justify-end pt-4 border-t border-border-color mt-6">
            <button type="submit" class="bg-primary-accent text-dark-bg border-none px-6 py-2.5 rounded-lg font-bold cursor-pointer inline-flex items-center justify-center disabled:opacity-60 disabled:bg-border-color disabled:cursor-not-allowed" [disabled]="isSaving() || productStageSaved() || productStageForm.invalid">
              @if (isSaving()) { <i class="fas fa-spinner animate-spin mr-2"></i><span>Guardando...</span> }
              @else if (productStageSaved()) { <i class="fas fa-check mr-2"></i><span>¡Guardado!</span> }
              @else { <span>Guardar Cambios</span> }
            </button>
          </div>
        </div>
      </form>
    }
    @case ('bundle') {
      <form [formGroup]="bundleForm" (ngSubmit)="saveBundle()" class="bg-dark-bg-secondary border border-border-color rounded-xl p-6">
        <h3 class="mb-6">Editar Bundle "Destacados"</h3>
        <div class="space-y-4">
          <div><label class="block text-sm font-medium text-text-primary mb-1">Título de la Sección</label><input formControlName="sectionTitle" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white"></div>
          <div><label class="block text-sm font-medium text-text-primary mb-1">URL Imagen Principal</label><input formControlName="imageUrl" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white"></div>
          <div><label class="block text-sm font-medium text-text-primary mb-1">Título Superpuesto</label><input formControlName="overlayTitle" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white"></div>
          <div><label class="block text-sm font-medium text-text-primary mb-1">Párrafo Superpuesto</label><textarea formControlName="overlayParagraph" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white" rows="2"></textarea></div>
          <div class="pt-4 border-t border-border-color mt-6">
            <div class="flex justify-between items-center">
              <h4 class="text-base font-bold">Productos del Bundle (Hotspots)</h4>
              <button type="button" (click)="addHotspot()" class="bg-primary-accent text-dark-bg border-none px-6 py-2.5 rounded-lg font-bold cursor-pointer inline-flex items-center justify-center disabled:opacity-60 disabled:bg-border-color disabled:cursor-not-allowed"><i class="fas fa-plus"></i></button>
            </div>
            <div formArrayName="hotspots" class="space-y-3 mt-3 max-h-60 overflow-y-auto pr-2">
              @for (hotspot of hotspots.controls; track $index) {
                <div [formGroupName]="$index" class="grid grid-cols-[2fr_1fr_2fr_2fr_auto] gap-3 items-center">
                  <input type="text" formControlName="title" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white !text-sm" placeholder="Nombre Producto">
                  <input type="text" formControlName="price" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white !text-sm" placeholder="Precio ($)">
                  <input type="text" formControlName="imageUrl" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white !text-sm" placeholder="URL Imagen (Móvil)">
                  <input type="text" formControlName="linkUrl" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white !text-sm" placeholder="Enlace (/product/slug)">
                  <button type="button" (click)="removeHotspot($index)" class="text-danger"><i class="fas fa-trash"></i></button>
                </div>
              }
            </div>
          </div>
          <div class="flex justify-end pt-4 border-t border-border-color mt-6">
            <button type="submit" class="bg-primary-accent text-dark-bg border-none px-6 py-2.5 rounded-lg font-bold cursor-pointer inline-flex items-center justify-center disabled:opacity-60 disabled:bg-border-color disabled:cursor-not-allowed" [disabled]="isSaving() || bundleSaved() || bundleForm.invalid">
              @if (isSaving()) { <i class="fas fa-spinner animate-spin mr-2"></i><span>Guardando...</span> }
              @else if (bundleSaved()) { <i class="fas fa-check mr-2"></i><span>¡Guardado!</span> }
              @else { <span>Guardar Cambios</span> }
            </button>
          </div>
        </div>
      </form>
    }
    @case ('quick-cat') {
      <form [formGroup]="quickCategoriesForm" (ngSubmit)="saveQuickCategories()" class="bg-dark-bg-secondary border border-border-color rounded-xl p-6">
        <div class="flex justify-between items-center mb-6">
          <h3 class="!m-0">Editar Sección "Categorías Rápidas" (Home)</h3>
          <button type="button" (click)="addQuickCategory()" class="bg-primary-accent text-dark-bg border-none px-6 py-2.5 rounded-lg font-bold cursor-pointer inline-flex items-center justify-center disabled:opacity-60 disabled:bg-border-color disabled:cursor-not-allowed"><i class="fas fa-plus"></i> Añadir</button>
        </div>
        <div formArrayName="categories" class="space-y-3 max-h-[60vh] overflow-y-auto pr-2">
          @for (category of quickCategoriesArray.controls; track $index) {
            <div [formGroupName]="$index" class="grid grid-cols-[2fr_2fr_2fr_auto] gap-3 items-center">
              <input type="text" formControlName="title" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white !text-sm" placeholder="Título (ej: Gaming)">
              <input type="text" formControlName="iconClass" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white !text-sm" placeholder="Icono (ej: fas fa-gamepad)">
              <input type="text" formControlName="link" class="w-full bg-dark-bg border border-border-color rounded-lg px-3 py-2 text-white !text-sm" placeholder="Enlace (/products/slug)">
              <button type="button" (click)="removeQuickCategory($index)" class="text-danger"><i class="fas fa-trash"></i></button>
            </div>
          }
        </div>
        <div class="flex justify-end pt-4 border-t border-border-color mt-6">
          <button type="submit" class="bg-primary-accent text-dark-bg border-none px-6 py-2.5 rounded-lg font-bold cursor-pointer inline-flex items-center justify-center disabled:opacity-60 disabled:bg-border-color disabled:cursor-not-allowed" [disabled]="isSaving() || quickCategoriesSaved() || quickCategoriesForm.invalid">
            @if (isSaving()) { <i class="fas fa-spinner animate-spin mr-2"></i><span>Guardando...</span> }
            @else if (quickCategoriesSaved()) { <i class="fas fa-check mr-2"></i><span>¡Guardado!</span> }
            @else { <span>Guardar Cambios</span> }
          </button>
        </div>
      </form>
    }
  }
</div>

<app-modal [isOpen]="isDeleteModalOpen" title="Confirmar Eliminación" (close)="closeDeleteConfirmation()">
  <p class="text-text-secondary">
    ¿Estás seguro de que deseas eliminar el banner
    <strong class="text-white">{{ bannerToDelete()?.internalName }}</strong>?
  </p>
  <div modal-footer class="flex justify-end gap-4">
    <button class="bg-primary-accent text-dark-bg border-none px-6 py-2.5 rounded-lg font-bold cursor-pointer inline-flex items-center justify-center disabled:opacity-60 disabled:bg-border-color disabled:cursor-not-allowed" (click)="closeDeleteConfirmation()">Cancelar</button>
    <button class="bg-primary-accent text-dark-bg border-none px-6 py-2.5 rounded-lg font-bold cursor-pointer inline-flex items-center justify-center disabled:opacity-60 disabled:bg-border-color disabled:cursor-not-allowed" (click)="handleDeleteBanner()" [disabled]="isSaving()">
      @if (isSaving()) {
        <i class="fas fa-spinner animate-spin mr-2"></i><span>Eliminando...</span>
      } @else {
        <span>Sí, Eliminar</span>
      }
    </button>
  </div>
</app-modal>
